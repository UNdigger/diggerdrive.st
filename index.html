<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 网盘</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        ul { list-style: none; padding: 0; }
        li { margin: 10px 0; }
        a { text-decoration: none; color: blue; }
    </style>
</head>
<body>
    <h1>GitHub 网盘</h1>
    <input type="file" id="fileInput" />
    <button onclick="uploadFile()">上传</button>
    <ul id="file-list">加载中...</ul>
    
    <script>
        const repo = "UNdigger/diggerdrive.st";
        const token = "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";
        const branch = "main";

        async function fetchFiles() {
            const url = `https://api.github.com/repos/${repo}/contents/`;
            const response = await fetch(url, {
                headers: { "Authorization": `token ${token}` }
            });
            const files = await response.json();
            const fileList = document.getElementById("file-list");
            fileList.innerHTML = "";
            
            files.forEach(file => {
                if (file.type === "file") {
                    const li = document.createElement("li");
                    const a = document.createElement("a");
                    a.href = file.download_url;
                    a.textContent = file.name;
                    a.target = "_blank";
                    li.appendChild(a);
                    fileList.appendChild(li);
                }
            });
        }

        async function uploadFile() {
            const fileInput = document.getElementById("fileInput");
            if (fileInput.files.length === 0) {
                alert("请选择一个文件！");
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = async function () {
                const content = reader.result.split(",")[1];
                const url = `https://api.github.com/repos/${repo}/contents/${file.name}`;
                
                const response = await fetch(url, {
                    method: "PUT",
                    headers: {
                        "Authorization": `token ${token}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        message: `上传 ${file.name}`,
                        content: content,
                        branch: branch
                    })
                });
                
                if (response.ok) {
                    alert("文件上传成功！");
                    fetchFiles();
                } else {
                    alert("上传失败！");
                }
            };
        }
        
        fetchFiles();
    </script>
</body>
</html>
